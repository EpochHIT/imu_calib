# Build Log — 2025-09-06

本文件记录了从失败到成功编译的关键输出与处理步骤，方便回溯。

## 1) 初始 CMake/构建环境输出
- Base path: /home/cwkj/catkin_imu_ws
- Using CMAKE_PREFIX_PATH: <略>
- catkin 0.8.10

## 2) 失败一：Ceres 本地残留导致的错误
```
CMake Error at /usr/local/lib/cmake/Ceres.bak-AVINS/CeresTargets.cmake:83 (message):
  The imported target "Ceres::ceres_cuda_kernels" references the file
     "/usr/local/lib/libceres_cuda_kernels.a" but this file does not exist.
```
处理：清理/禁用 /usr/local 下 Ceres 残留；构建时指定
```
-DCeres_DIR=/usr/lib/aarch64-linux-gnu/cmake/Ceres -DCERES_DIR=...
```

## 3) 失败二：OpenCV 头库混用
```
/usr/local/include/opencv2/core/cvstd.inl.hpp:177: undefined reference to `cv::Formatter::get(int)'
...
```
处理：固定 OpenCV 4.5.4 EXACT，并避免拾取 /usr/local 的旧头。

## 4) 失败三：backward.hpp 缺少 libdw 链接
```
undefined reference to `dwarf_child' / `dwfl_begin' / ...
```
处理：在 CMake 中为可执行添加 libdw（pkg-config 优先，否则 -ldw）。

## 5) 源码不兼容 OpenCV 4.x 宏
```
CV_LOAD_IMAGE_GRAYSCALE / CV_LOAD_IMAGE_UNCHANGED / CV_MINMAX 未声明
```
处理：替换为 cv::IMREAD_GRAYSCALE / cv::IMREAD_UNCHANGED / cv::NORM_MINMAX；Vec12b -> Vec3b。

## 6) 成功构建命令
```
catkin_make -DCeres_DIR=/usr/lib/aarch64-linux-gnu/cmake/Ceres -DCERES_DIR=/usr/lib/aarch64-linux-gnu/cmake/Ceres
```

## 7) 经验要点
- 避免 /usr/local 残留与系统包混用；显式指定 *_DIR。
- 链接期 undefined reference：区分缺库 vs 头库不匹配两类。
- OpenCV 4.x 升级需要同步替换废弃宏/常量。
